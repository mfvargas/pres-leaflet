<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Leaflet</title>
		
		<meta name="description" content="Fundamentos de Leaflet para desarrollo de aplicaciones geoespaciales en la Web">
		<meta name="author" content="Manuel Vargas">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">		

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/journal.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
			<section id="portada">
				<h2>Leaflet</h2>
				<br>
				<small>Manuel Vargas (<a href="mailto:mfvargas@gmail.com">mfvargas@gmail.com</a>)</small>
				<br>
				<small>Octubre de 2019</small>
			</section> 				
			<section id="leaflet-01">
				<h2>Leaflet</h2>
				<ul>
					<p><a href="https://leafletjs.com/">Leaflet</a> es una biblioteca de programación en <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">JavaScript (JS)</a> para hacer mapas en la Web.</p>
					<p>Es de <strong>código abierto</strong> y fue diseñada para funcionar en una gran variedad de dispositivos, incluyendo <strong>móviles (ej. celulares, tabletas)</strong>.</p>
					<p>Su funcionalidad puede ser extendida a través de <a href="https://leafletjs.com/plugins.html">complementos</a>.</p>
				</ul>
			</section>
			<section id="leaflet-02">
				<h2>Leaflet</h2>
				<ul>
					<p>Su primera versión fue publicada en <strong>2011</strong> por <strong>Vladimir Agafonkin</strong>.</p>
					<p>Junto con <a href="https://openlayers.org/">OpenLayers</a> y <a href="https://developers.google.com/maps/documentation">Google Maps</a>, es una de las más bibliotecas más populares para programar mapas en la Web.</p>					
				</ul>
			</section>		
			<section id="leaflet-03">
				<h2>Leaflet</h2>
				<ul>
					<p>El código JS de Leaflet se invoca desde documentos en <a href="https://whatwg.org/">lenguaje de marcas de hipertexto (HTML)</a>.</p>
					<p>La biblioteca JS se distribuye junto con un conjunto de <a href="https://www.w3.org/Style/CSS/">hojas de estilo (CSS)</a>.</p>
				</ul>
			</section>			
			<section id="documentacion">
				<h2>Documentación</h2>
				<ul>
					<p>La <a href="">referencia del API de Leaflet</a> contiene la documentación de las clases, métodos, eventos y demás componentes para la  programación en JS.</p>
					<p>El sitio oficial contiene también un conjunto de <a href="https://leafletjs.com/examples.html">tutoriales y ejemplos</a>.</p>
				</ul>
			</section>	
			<section id="preparacion-uso-01">
				<h2>Preparación para el uso</h2>
				<p>De acuerdo con la <a href="https://leafletjs.com/examples/quick-start/">guía de inicio rápido</a>, para utilizar Leaflet en un sitio web, primero se debe incluir en el código HTML:</p>
				<ul>
					<li>Un enlace a la hoja CSS de Leaflet.</li>
					<li>Un enlace a la biblioteca JS.</li>
					<li>Un elemento <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div">div</a> para contener el mapa.</li>					
				</ul>
			</section>	
			<section id="preparacion-uso-02">
				<h2>Preparación para el uso</h2>
				<p>Los archivos JS y CSS de Leaflet pueden obtenerse a través de:</p>
				<ul>
					<li>Descargas del <a href="https://github.com/Leaflet/Leaflet">repositorio de código fuente</a>.</li>
					<li>Enlaces a una <a href="https://leafletjs.com/download.html">red de distribución de contenidos (CDN)</a>.</li>
				</ul>
			</section>									
			<section id="preparacion-uso-03">
				<h2>Preparación para el uso</h2>
				<p>Como recomendación para los programadores, se sugiere mantener en archivos y directorios separados el código:</p>
				<ul>
					<li>HTML (*.html)</li>
					<li>CSS (*.css)</li>
					<li>JS (*.js)</li>
				</ul>
			</section>
			<section id="archivo-html-ejemplo">
				<h2>Ejemplo de documento HTML con elementos para Leaflet</h2>
				<pre><code class="hljs" data-trim contenteditable>
					&lt;!DOCTYPE html&gt;
					&lt;html lang=&quot;es&quot;&gt;
					&lt;head&gt;
						&lt;meta charset=&quot;UTF-8&quot;&gt;
						&lt;title&gt;Mapa de Leaflet&lt;/title&gt;   

						&lt;!-- Hoja de estilos CSS de Leaflet --&gt;
						&lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet@1.5.1/dist/leaflet.css&quot; integrity=&quot;sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==&quot; crossorigin=&quot;&quot;/&gt;	
						&lt;!-- Biblioteca JS de Leaflet --&gt;
						&lt;script src=&quot;https://unpkg.com/leaflet@1.5.1/dist/leaflet.js&quot; integrity=&quot;sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==&quot; crossorigin=&quot;&quot;&gt;&lt;/script&gt;	
						&lt;!-- Complemento Leaflet-providers --&gt;
						&lt;script src=&quot;js/leaflet-providers.js&quot;&gt;&lt;/script&gt;	
						
						&lt;!-- Hoja de estilos CSS adicionales --&gt;
						&lt;link rel=&quot;stylesheet&quot; href=&quot;css/estilos.css&quot;/&gt;			
					&lt;/head&gt;
					&lt;body&gt;
						&lt;!-- Elemento div para contener el mapa --&gt;
						&lt;div id=&quot;mapid&quot;&gt;&lt;/div&gt;	
						
						&lt;!-- C&oacute;digo principal en JS --&gt;
						&lt;script src=&quot;js/scripts.js&quot;&gt;&lt;/script&gt;	
					&lt;/body&gt;
					&lt;/html&gt;
				</code></pre>
			</section>	
			<section id="archivo-css-ejemplo">
				<h2>Ejemplo de archivo CSS con selectores para Leaflet</h2>
				<pre><code class="hljs" data-trim contenteditable>
					#mapid { 
						height: 700px;
						width:  700px;
					}
				</code></pre>
			</section>				
			<section id="clase-map">
				<h2>La clase Map</h2>
				<p>La clase <a href="https://leafletjs.com/reference-1.5.0.html#map">Map</a> es la clase central del API de Leaflet. Se utiliza para crear un mapa y manipularlo.</p>
				<pre><code class="hljs" data-trim contenteditable>
					// Se inicializa un mapa con un centro y un nivel de acercamiento iniciales
					var map = L.map('map', {
						center: [51.505, -0.09],
						zoom: 13
					});						
				</code></pre>
			</section>
			<section id="metodo-setView">
				<h2>El método setView</h2>
				<p>El método <a href="https://leafletjs.com/reference-1.5.0.html#map-setview">setView</a> asigna una vista (centro y nivel de acercamiento) y niveles de animación al mapa.</p>
				<pre><code class="hljs" data-trim contenteditable>
					// Definición de la vista de un mapa
					map.setView(L.latLng([10, -84]), 10);					
				</code></pre>
			</section>				
			<section id="clase-tileLayer">
				<h2>La clase TileLayer</h2>
				<p>La clase <a href="https://leafletjs.com/reference-1.5.0.html#tilelayer">TileLayer</a> se utiliza para desplegar capas de teselas.</p>
				<pre><code class="hljs" data-trim contenteditable>
					// Despliegue de la capa de OpenStreetMap
					L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?{foo}', 
								{foo: 'bar', 
								attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}).addTo(map);					
				</code></pre>
				<p>Puede usarse en combinación con el complemento <a href="https://github.com/leaflet-extras/leaflet-providers">Leaflet-providers</a>.</p>
			</section>		
			<section id="complemento-leaflet-providers">
				<h2>El complemento Leaflet-providers</h2>
				<p>El complemento <a href="https://github.com/leaflet-extras/leaflet-providers">Leaflet-providers</a> simplifica el despliegue de capas de teselas de varios <a href="http://leaflet-extras.github.io/leaflet-providers/preview/">proveedores</a>.</p>
				<pre><code class="hljs" data-trim contenteditable>
					// Despliegue de la capa World Imagery de ESRI
					L.tileLayer.provider("Esri.WorldImagery").addTo(map);
				</code></pre>
				<p>Algunos <a href="https://github.com/leaflet-extras/leaflet-providers#providers-requiring-registration">proveedores requieren de un registro previo</a> para el uso de sus capas.</p>
			</section>	
			<section id="archivo-js-ejemplo">
				<h2>Ejemplo de archivo JS para Leaflet</h2>
				<pre><code class="hljs" data-trim contenteditable>
					// Creación de un mapa de Leaflet
					var map = L.map("mapid");

					// Centro del mapa y nivel de acercamiento
					var catedralSJ = L.latLng([9.9326673, -84.0787633]);
					var zoomLevel = 17;

					// Definición de la vista del mapa
					map.setView(catedralSJ, zoomLevel);

					// Adición de capa
					L.tileLayer.provider("OpenStreetMap.Mapnik").addTo(map);
				</code></pre>
			</section>
			<section id="clase-marker">
				<h2>La clase Marker</h2>
				<p>La clase <a href="https://leafletjs.com/reference-1.5.0.html#marker">Marker</a> se utiliza para desplegar marcadores en el mapa.</p>
				<p>Puede utilizarse conjuntamente con las clases <a href="https://leafletjs.com/reference-1.5.0.html#popup">Popup</a> y <a href="https://leafletjs.com/reference-1.5.0.html#tooltip">Tooltip</a>, para desplegar información en ventanas emergentes.</p>
				<pre><code class="hljs" data-trim contenteditable>
					// Marcador para la Catedral Metropolitana de San José
					var catedralSJMarker = L.marker([9.9326673, -84.0787633])
					catedralSJMarker.bindPopup('<a href="https://es.wikipedia.org/wiki/Catedral_metropolitana_de_San_Jos%C3%A9">Catedral Metropolitana de San José</a>.<br>Catedral de estilo clásico y barroco. Templo principal de la arquidiócesis católica de San José.<br>Construída entre 1825 y 1827 y reconstruída en 1878.').openPopup();
					catedralSJMarker.bindTooltip("Catedral Metropolitana de San José").openTooltip();				
				</code></pre>
			</section>		
			<section id="clase-marker-personalizada">
				<h2>Marcadores personalizados</h2>
				<p>Varios sitios web ofrecen íconos que pueden utilizarse como marcadores personalizados. Por ejemplo, <a href="https://fontawesome.com/">Font Awesome</a>.</p>
				<pre><code class="hljs" data-trim contenteditable>
					&lt;!-- En HTML: enlace a Font Awesome --&gt;
					&lt;link rel=&quot;stylesheet&quot; href=&quot;https://use.fontawesome.com/releases/v5.0.13/css/all.css&quot;
					integrity=&quot;sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp&quot;
					crossorigin=&quot;anonymous&quot; /&gt;				
				</code></pre>
				<pre><code class="hljs" data-trim contenteditable>
					// En JS: marcador para la Catedral Metropolitana de San José
					var catedralSJMarker = L.marker([9.9326673, -84.0787633],
						{ icon: L.divIcon(
							{ html: '<i class="fas fa-church"></i>'}
						)}
					)				
				</code></pre>
			</section>
			<section id="clase-geojson">
				<h2>La clase GeoJSON</h2>
				<p>La clase <a href="https://leafletjs.com/reference-1.5.0.html#geojson">GeoJSON</a> se utiliza para contener una capa de objetos GeoJSON.</p>
				<pre><code class="hljs" data-trim contenteditable>
					var geojsonFeature = {
						"type": "Feature",
						"properties": {
							"name": "Coors Field",
							"amenity": "Baseball Stadium"
						},
						"geometry": {
							"type": "Point",
							"coordinates": [-104.99404, 39.75621]
						}
					};				

					L.geoJSON(geojsonFeature).addTo(map);					
				</code></pre>
			</section>
			<section id="archivos-geojson">
				<h2>Archivos GeoJSON</h2>
				<p>Si van a utilizarse archivos GeoJSON (*.geojson), estos deben estar publicados en un <a href="https://en.wikipedia.org/wiki/Web_server">servidor web</a>. Para pruebas, puede utilizarse el módulo <a href="https://docs.python.org/3/library/http.server.html">http.server</a> de Python, el cual está disponible desde la línea de comandos de Anaconda, con el comando:</p>
				<pre><code class="hljs" data-trim contenteditable>
					python -m http.server 8888
				</code></pre>
				<p>Este módulo inicia un servidor web local que puede accederse en <a href="http://localhost:8888/">http://localhost:8888/</a></p>
			</section>
			<section id="archivos-geojson-02">
				<h2>Archivos GeoJSON</h2>
				<p>Pueden obtenerse y procesarse, por ejemplo, con comandos de <a href="https://gdal.org/">GDAL/OGR</a>:</p>
				<pre><code class="hljs" data-trim contenteditable>
					ogr2ogr -f "GeoJSON" -t_srs EPSG:4326 -simplify 100 provincias.geojson WFS:"http://geos.snitcr.go.cr/be/IGN_5/wfs?" limiteprovincial_5k
				</code></pre>
			</section>
			<section id="clase-geojson-jquery">
				<h2>Capas de archivos GeoJSON en Leaflet</h2>
				<p>Pueden procesarse con la función <a href="https://api.jquery.com/jQuery.getJSON/">getJSON de jQuery</a></p>
				<pre><code class="hljs" data-trim contenteditable>
					$.getJSON("datos/asp.geojson", function(geodata) {
						var layer_geojson_asp = L.geoJson(geodata, {
							style: function(feature) {
								return {
									'color': "#00ff00",
									'weight': 2,
									'fillOpacity': 0.0
								}
							},
							onEachFeature: function(feature, layer) {
								var popupText = "Área protegida: " + feature.properties.nombre_asp + "<br>" +
																"Categoría: " + feature.properties.cat_manejo;
								layer.bindPopup(popupText);
							}			
						}).addTo(map);
						control_layers.addOverlay(layer_geojson_asp, 'Áreas protegidas');
					});			
				</code></pre>
			</section>			
			<section id="jquery-01">
				<h2>La biblioteca jQuery</h2>
				<p><a href="https://jquery.com/">jQuery</a> es una biblioteca JS, de gran popularidad, que facilita el acceso al DOM, entre otras capacidades.</p>
				<p>Antes de utilizarse, debe incluirse su enlace en el documento HTML:</p>
				<pre><code class="hljs" data-trim contenteditable>
					&lt;!-- Enlace a biblioteca JQuery --&gt;
					&lt;script src=&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;
						integrity=&quot;sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=&quot;
						crossorigin=&quot;anonymous&quot;&gt;
					&lt;/script&gt;				
				</code></pre>
			</section>
			<section id="jquery-02">
				<h2>La biblioteca jQuery</h2>
				<p>jQuery define una función global llamada <strong>jQuery()</strong>, la cual acostumbra referenciarse de manera abreviada con el símbolo <strong>$</strong>.</p>
				<p>Por ejemplo, la primera sentencia del siguiente bloque almacena en una variable todos los elementos &ltdiv&gt de un documento y la segunda cambia el color de todos los elementos &lth1&gt.</p>
				<pre><code class="hljs" data-trim contenteditable>
					var divs = $("div");
					
					$("h1").css("color", "#0088ff");
				</code></pre>
			</section>				
			<section id="clase-control">
				<h2>La clase Control</h2>
				<p>
					La clase <a href="https://leafletjs.com/reference-1.5.0.html#control">Control</a> es la clase base para implementar controles en un mapa. Todas las clases de controles heredan de esta clase.
					Ejemplos de clases de controles:
				</p>
				<ul>
					<li><a href="https://leafletjs.com/reference-1.5.0.html#control-zoom">Zoom</a>: botones de acercamiento y alejamiento.</li>
					<li><a href="https://leafletjs.com/reference-1.5.0.html#control-attribution">Attribution</a>: datos de atribución (ej. autoría).</li>
					<li><a href="https://leafletjs.com/reference-1.5.0.html#control-layers">Layers</a>: activa y desactiva capas.</li>
					<li><a href="https://leafletjs.com/reference-1.5.0.html#control-scale">Scale</a>: añade una escala.</li>
				</ul>
			</section>				
			<section id="control-layers">
				<h2>El control Layers</h2>
				<p>El control <a href="https://leafletjs.com/reference-1.5.0.html#control-layers">Layers</a> le permite al usuario seleccionar la capa base del mapa y también activar y desactivar capas sobrepuestas.</p>
				<pre><code class="hljs" data-trim contenteditable>
					esriLayer = L.tileLayer.provider("Esri.WorldImagery").addTo(map);
					osmLayer = L.tileLayer.provider("OpenStreetMap.Mapnik").addTo(map);
					openRailwayLayer = L.tileLayer.provider("OpenRailwayMap").addTo(map);
					
					var baseMaps = {
						"ESRI World Imagery": esriLayer,
						"OpenStreetMap": osmLayer    
					};
					var overlayMaps = {
						"Open Railway": openRailwayLayer
					};
					L.control.layers(baseMaps, overlayMaps).addTo(map);			
				</code></pre>
			</section>
			<section id="control-scale">
				<h2>El control Scale</h2>
				<p>El control <a href="https://leafletjs.com/reference-1.5.0.html#control-scale">Scale</a> muestra una escala en el sistema métrico decimal y en el sistema imperial.</p>
				<pre><code class="hljs" data-trim contenteditable>
					L.control.scale().addTo(map);			
				</code></pre>
			</section>			
			<section id="clase-tilelayer-wms">
				<h2>La clase TileLayer.WMS</h2>
				<p>La clase <a href="https://leafletjs.com/reference-1.5.0.html#tilelayer-wms">TileLayer.WMS</a> se utiliza para desplegar un servicio <a href="https://en.wikipedia.org/wiki/Web_Map_Service">WMS</a> en el mapa.</p>
				<pre><code class="hljs" data-trim contenteditable>
					var distritosWMSLayer = L.tileLayer.wms('http://geos.snitcr.go.cr/be/IGN_5/wms?', {
						layers: 'limitedistrital_5k',
						transparent: true
					}).addTo(map);
				</code></pre>
			</section>					
			<section id="clase-imageoverlay">
				<h2>La clase Image.Overlay</h2>
				<p>La clase <a href="https://leafletjs.com/reference-1.5.0.html#imageoverlay">Image.Overlay</a> se utiliza para cargar y desplegar una imagen sobre un área específica del mapa.</p>
				<pre><code class="hljs" data-trim contenteditable>
					var temperaturaLayer = L.imageOverlay("bio1_cr.png", 
						[[11.2197734290000000, -85.9790724540000042], 
						[8.0364413690000003, -82.5540738239999996]], 
						{opacity:0.5}
					).addTo(map);
				</code></pre>
				<p><small>El archivo utilizado como ejemplo proviene de datos de la iniciativa <a href="https://www.worldclim.org/">WorldClim</a>. Hay versiones recortadas para Costa Rica en <a href="https://github.com/mfvargas/worldclim1-cr">https://github.com/mfvargas/worldclim1-cr</a>.</small></p>
			</section>									
			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
    history: true,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
